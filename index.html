<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>MathRPG – Student</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Arial,sans-serif;max-width:640px;margin:40px auto;padding:0 16px}
    .card{border:1px solid #ddd;border-radius:12px;padding:16px;margin:12px 0}
    label{display:block;margin:8px 0 4px}
    input,button{font-size:16px;padding:8px}
    button{cursor:pointer}
  </style>
</head>
<body>
  <h1>MathRPG – Student</h1>

  <div class="card">
    <h2>Join Session</h2>
    <label>Class Code</label>
    <input id="classCode" placeholder="e.g. 3B-Math" />
    <label>Nickname</label>
    <input id="nickname" placeholder="Pick a nickname" />
    <button id="joinBtn">Join</button>
    <p id="joinMsg"></p>
  </div>

  <div class="card" id="demo" style="display:none">
    <h2>Demo Encounter</h2>
    <p><strong>Enemy:</strong> Practice Dummy — <span id="enemyHp">50</span> HP</p>
    <p><strong>Question:</strong> What is 7 + 5 ?</p>
    <input id="answer" placeholder="Type your answer" />
    <button id="submitBtn">Submit</button>
    <p id="result"></p>
  </div>

  <script>
    const state = JSON.parse(localStorage.getItem('mathrpg')||'{}');
    const el = (id)=>document.getElementById(id);

    function showDemo() {
      document.getElementById('demo').style.display = 'block';
      el('joinMsg').textContent = `Joined as ${state.nickname} in class ${state.classCode}.`;
    }

    if (state.nickname && state.classCode) showDemo();

    el('joinBtn').onclick = () => {
      const classCode = el('classCode').value.trim();
      const nickname = el('nickname').value.trim();
      if (!classCode || !nickname) { el('joinMsg').textContent = 'Please fill both fields.'; return; }
      localStorage.setItem('mathrpg', JSON.stringify({ classCode, nickname, hp: 20, enemyHp: 50 }));
      Object.assign(state, { classCode, nickname, hp: 20, enemyHp: 50 });
      showDemo();
    };

    el('submitBtn').onclick = () => {
      const a = el('answer').value.trim();
      if (a === '12') {
        state.enemyHp = Math.max(0, (state.enemyHp ?? 50) - 10);
        el('enemyHp').textContent = state.enemyHp;
        el('result').textContent = 'Correct! You dealt 10 damage.';
      } else {
        el('result').textContent = 'Miss! Try again.';
      }
      localStorage.setItem('mathrpg', JSON.stringify(state));
      if (state.enemyHp === 0) el('result').textContent = 'Victory! The dummy is defeated.';
    };

    if (state.enemyHp != null) el('enemyHp').textContent = state.enemyHp;
  </script>
</body>
</html>
